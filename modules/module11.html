<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="" />
	  <meta name="viewport" content="width=device-width, user-scalable=no">
	
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic|Nova+Square' rel='stylesheet' type='text/css'>
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <title>Analyzing the Data (Part 1)</title>

    <link href="../stylesheets/codes.css" rel="stylesheet" type="text/css" />
    <link href="../stylesheets/style.css" rel="stylesheet" type="text/css" />
  </head>

  <body class="modules modules_module11">
    <!-- HEADER -->
        <header>
				<div class="wrap">
	    <h1 id="project_title">DH Bridge</h1>
	    <h2 class="tag">Encouraging Computational Thinking and Digital Skills in the Humanities</h2>

	    <nav id="pages">
	    	<a href="/">Computational Thinking</a>
	    	<a href="http://dhbridge.org">About DH Bridge</a>
	    </nav>
	</div>
        </header> 
        <!-- MAIN CONTENT -->
        <div class="wrap">
            <div id="main">
              <article>
                		<section id="sidebar">
			<h2>Modules</h2>
			<a href="/modules/installation.html">Installation Instructions</a>

			<ol>
			<li><a href="/modules/module01.html">Working with your Computer</a></li>
			<li><a href="/modules/module02.html">Thinking about Data</a></li>
			<li><a href="/modules/module03.html">Getting Data</a></li>
			<li><a href="/modules/module04.html">Working with the API</a></li>
			<li><a href="/modules/module05.html">Writing Script Files</a></li>
			<li><a href="/modules/module06.html">Phase Two</a></li>
			<li><a href="/modules/module07.html">Using Functions and Loops</a></li>
			<li><a href="/modules/module08.html">Using While-Loops</a></li>
			<li><a href="/modules/module09.html">Writing Results to File</a></li>
			<li><a href="/modules/module10.html">Working with Local Data</a></li>
			<li><a href="/modules/module11.html">Gathering a Subset of Data</a></li>
			<li><a href="/modules/module12.html">Analyzing a Subset of the Data</a></li>
			<li><a href="/modules/module13.html">Saving Results to a File</a></li>
			</ol>
		</section>

                <section id="content">
                        <h2>
          Analyzing the Data (Part 1)
      </h2>
       <h3 id="installing-nltk">Installing NLTK</h3>

<p>We are interested in the languaged used in the "description" fields across all the "cooking" items in the DPLA database. Fortunately, there is good support within Python for text analysis and one power library we can use is the Natural Language ToolKit (or NLTK).</p>

<p>To install NLTK, let's go back to our terminal and use pip.</p>

<p>Run <span class="command">pip install nltk</span>. You may need to use <span class="command">sudo pip install nltk</span>.</p>

<p>Now, go back to your file and import nltk at the top of the file.</p>

<p>There are also a number of datasets available for use with nltk. For our purposes, we will only be using the 'stopwords' dataset, but you can browse the list of all the datasets you could download and use at <a href="http://www.nltk.org/nltk_data/">http://www.nltk.org/nltk_data/</a>. </p>

<p>To download the stopwords, we are going to go back into the Python Interactive Shell. Run <span class="command">python</span>. Your terminal window should now look something like this:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>Python 2.7.5 (default, Mar  9 2014, 22:15:05)
[GCC 4.2.1 Compatible Apple LLVM 5.0 (clang-500.0.68)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; 
</pre></td></tr></tbody></table>
</div>

<p>Type <span class="command">import nltk</span> and press enter.</p>

<p>Next type <span class="command">nltk.download('stopwords')</span> and press enter.</p>

<p>Once you see </p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>True
&gt;&gt;&gt;
</pre></td></tr></tbody></table>
</div>

<p>you have successfully downloaded the stopwords file. You can now exit the Python Interactive Shell using <span class="command">quit()</span></p>

<p>Great!</p>

<p>Now we need to load these stopwords into our Python file. Switching back to our "my_second_script.py" file, add <span class="command">from nltk.corpus import stopwords</span> to the top of the file.</p>

<p>Your file should now look like:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre>import json
from collections import Counter
import nltk
from nltk.corpus import stopwords

with open("search_results.json") as json_file:
    json_data = json.load(json_file)

#print json_data[1]
</pre></td></tr></tbody></table>
</div>

<p>We are now ready to start working with our data.</p>

<h3 id="what-we-learned">What We Learned</h3>

<p>In this module, we have reviewed and learned:</p>

<ul>
  <li>to create new files using terminal</li>
  <li>to load json data from a file </li>
  <li>to download libraries using pip</li>
  <li>to download datasets within libraries</li>
  <li>to load libraries into our scripts</li>
</ul>

<p>In this module, we will learn how to collect and store the description data from each item in our "json_data" variable. To do this, we will first identify the location of the description with the data structure and then loop through each item, saving each of the words in the description into a new list.</p>

<h3 id="identifying-our-target-fields">Identifying Our Target Fields</h3>

<p>Remember back to JSON and how it organizes data using key:value pairs? One of the most powerful features of JSON is that we are able to nest features and create lists within key:value pairs. This is useful for creating complex data structures. It also means that we have work within the hierarchy of key:value pairs to isolate particular values.</p>

<p>In order to better see that hierarchy, let's "Pretty Print" the JSON results, or print with the indentations and hierarchies visually displayed. </p>

<p>Open "my_second_script.py" and "comment out" "print jason_data[0]" by putting # at the beginning of the line.</p>

<p>At the bottom of your script, add the line:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>print json.dumps(json_data[1], sort_keys=True, indent=4, separators=(',', ': '))
</pre></td></tr></tbody></table>
</div>

<p>Save and run in Terminal. </p>

<p>Work with your table to map out what this command did.</p>

<p>We now need to find the "description" field within the json object. You can either read through all of the lines of code or you can search within Terminal by pressing "command F" on a Mac and Windows, click the menu button and go to Edit -&gt; Find. </p>

<p>Looking at the "description" field, work with your table to identify the key name it is nested under. </p>

<p>The syntax for calling items within a data structure uses brackets to designate the key names or the position in the list of the item we want to interact with. We already use this syntax when we call the first item in the data by using <span class="command">json_data[1]</span>. This form means we want the first item in the json_data object. </p>

<p>If we want the value associated with the "description" key, we use a similar format. </p>

<p>To print only the description for the first item in our list, add the following to the bottom of your "my_second_script.py" file:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>print json_data[1]['sourceResource']['description']
</pre></td></tr></tbody></table>
</div>

<p>Work with your table to print only the titles. What about only the subject headings?</p>

<h3 id="saving-the-descriptions">Saving the Descriptions</h3>

<p>One way to look at the descriptions is to consider them as a collection, or list, of words. If we take all of the collections as a whole, we can ask if there are any noticable patterns in the words being used to describe these items related to cooking.</p>

<p>One common way of dealing with text computationally is to translate the text into a "bag of words". In a bag of words approach, the order does not matter. What we are looking at instead is the collection of words and their frequencies.</p>

<p>To create a "bag of words" from the descriptions we need to 1) create a list to store the words and 2) write a loop that takes every description and adds the words to the list.</p>

<p>See if you can use the information in module 7 (functions and loops) to create an empty list.</p>

<p>Currently our "my_second_script.py" file should look like this:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre>import json
from collections import Counter
import nltk
from nltk.corpus import stopwords

with open("search_results.json") as json_file:
   json_data = json.load(json_file)
	
#print json_data[1]
#print json.dumps(json_data[1], sort_keys=True, indent=4, separators=(',', ': '))

print json_data[1]['sourceResource']['description']
</pre></td></tr></tbody></table>
</div>

<p>Let's use "description_words" as the variable for our empty list of stopwords. Remember that variables go after we import the libraries and before our functions. </p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>description_words = []
</pre></td></tr></tbody></table>
</div>

<p>Next, we will create a new function called "get_words"</p>

<p>Declare the function by adding:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>def get_words():
</pre></td></tr></tbody></table>
</div>

<p>Next, tab in once and add a for-loop to move through each item in the json_data list:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>def get_words():
   for each in json_data:
</pre></td></tr></tbody></table>
</div>

<p>Next, let's set up a variable to grab the descriptions:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>def get_words():
    for each in json_data:
        descriptions = each['sourceResource']['description']
</pre></td></tr></tbody></table>
</div>

<p>Now, description holds the full sentence as a single object and we want to get the individual words. We can use a built in function called "split" that divides the sentence into an array of individual objects, splitting on the spaces and punctuation marks.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>def get_words():
    for each in json_data:
        descriptions = each['sourceResource']['description']
        for line in descriptions:
            words = line.split()
</pre></td></tr></tbody></table>
</div>

<p>To see what just happened, let's add a print statement:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre>def get_words():
    for each in json_data:
        descriptions = each['sourceResource']['description']
        for line in descriptions:
            words = line.split()
            print words
</pre></td></tr></tbody></table>
</div>

<p>Now "call the function" by adding <span class="command">get_words()</span> to the end of the file.	</p>

<p>Your file should now look like this:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre>import json
from collections import Counter
import nltk
from nltk.corpus import stopwords

with open("search_results.json") as json_file:
    json_data = json.load(json_file)

description_words = []	

def get_words():
    for each in json_data:
        descriptions = each['sourceResource']['description']
        for line in descriptions:
            words = line.split()
            print words

#print json_data[1]
#print json.dumps(json_data[1], sort_keys=True, indent=4, separators=(',', ': '))

print json_data[1]['sourceResource']['description']

get_words()
</pre></td></tr></tbody></table>
</div>

<p>Save the file and run it in the terminal.</p>

<p>You might first notice that this script threw an error, saying:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>KeyError: 'description'
</pre></td></tr></tbody></table>
</div>

<p>One of the most important things in learning to work with code is learning to decipher error messages. If you read a little more in your terminal window, you'll see that the full message is something like this:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre>jeriwieringa$ python my_second_script.py
Traceback (most recent call last):
  	File "my_second_script.py", line 21, in &lt;module&gt;
	get_words()
  	File "my_second_script.py", line 16, in get_words
	descriptions = each['sourceResource']['description']
KeyError: 'description'
</pre></td></tr></tbody></table>
</div>

<p>We have a traceback saying in our "get_words()" function there was an error on line 16 where we told it to save the value associated with the "description" key to the variable "descriptions". </p>

<p>Let's see what is going. Comment out the call to "get_words" function.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre># get_words()
</pre></td></tr></tbody></table>
</div>

<p>Now let's print the first object in the json_data list. Uncomment our print statement at the beginning of the file that pretty-prints the json. Change the 1 to 0, the save and run the file.</p>

<p>Search for 'description' under 'sourceResource'. If you can't find it, it's because this item appears to be missing "description" information. Because the computer can't find the description, it returns an error and stops.</p>

<p>Getting around this problem requires what is called "handling exceptions". We had expected a particular pattern in our data (that there was "description" keys nested under "sourceResource" keys) but we've encountered an exception to that general pattern. </p>

<p>To tell the computer to keep moving if it encounters an item it cannot parse because of a KeyError, we will adjust our get_words() function as follows:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre>def get_words():
    for each in json_data:
        try:
            descriptions = each['sourceResource']['description']
            for line in descriptions:
                words = line.split()
                print words
        except KeyError:
            print "Description Missing"
</pre></td></tr></tbody></table>
</div>

<p>Un-comment "get_words()", save, and run the file.</p>

<p>Our script should no longer error. If your script is spitting out letters forever, you can stop the process with "control + c" or "command + c"</p>

<p>But, now it seems that sometime we are getting a list of letters, and sometimes a list of words. So one more adjustment is in order. We need to perform a check, where if the value of descriptions is a string, the function does one thing, and if it is not a string, it does something else. Our current code works well on the lists, so we will keep that for not strings.</p>

<p>To check if the value in "descriptions" in a string, we can add the following:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre>def get_words():
    for each in json_data:
        try:
            descriptions = each['sourceResource']['description']
            if isinstance(descriptions, basestring):
                words = descriptions.split()
            else:
                for line in descriptions:
                    words = line.split()
            print words
        except KeyError:
            print "Description Missing"
</pre></td></tr></tbody></table>
</div>

<p>Looking through the information printing to our terminal window, it looks like we have correctly split out all of the words.</p>

<p>This is an example of creating a work around when working with data that is beyond our control. What has happened is that some institutions have a description field that looks like this:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>'description': 'A wonderful description sentence or two giving you a summary of the item'
</pre></td></tr></tbody></table>
</div>

<p>And some have used the description field like this:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>'description': [
    "one line of information", 
    "another line of information"
] 
</pre></td></tr></tbody></table>
</div>

<p>To accommodate this, we create one process for the first case, by checking if the value is a string and a second process for the second case.</p>

<h3 id="adding-the-words-to-our-bag-of-words">Adding the words to our "bag of words"</h3>

<p>The final step in creating our subset of data is to add the words into our "description_words" list.</p>

<p>To do this, we will need to loop through the "words" list and add each word to the "description_words" list. This means another for-loop within the "try" second of our function. Also, now that we know that our words are parsing correctly, we can remove "print words".</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre>def get_words():
    for each in json_data:
        try:
            descriptions = each['sourceResource']['description']
            if isinstance(descriptions, basestring):
                words = descriptions.split()
            else:
                for line in descriptions:
                    words = line.split()
                    for word in words:
                        description_words.append(word)

        except KeyError:
            print "Description Missing"
</pre></td></tr></tbody></table>
</div>

<p>Now to check that everything worked ok, let's run the function and print out the 1000 word in our "descriptions_words"</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></td><td class="code"><pre>import json
from collections import Counter
import nltk
from nltk.corpus import stopwords

with open("search_results.json") as json_file:
    json_data = json.load(json_file)

#print json_data[1]
#print json.dumps(json_data[0], sort_keys=True, indent=4, separators=(',', ': '))

#print json_data[0]['sourceResource']['description']

description_words = []

def get_words():
    for each in json_data:
        try:
            descriptions = each['sourceResource']['description']
            if isinstance(descriptions, basestring):
                words = descriptions.split()
            else:
                for line in descriptions:
                    words = line.split()

            for word in words:
                description_words.append(word)

        except KeyError:
            print "Description Missing"

get_words()
print description_words[999]
</pre></td></tr></tbody></table>
</div>

<h3 id="group-challenge">Group Challenge:</h3>

<ul>
  <li>Can you modify the function to also add the words of the title to our bag of words?</li>
  <li>Can you also add the subject headings?</li>
</ul>

<h3 id="what-we-learned-1">What We Learned</h3>

<p>In this module, we learned:</p>

<ul>
  <li>to pretty-print json with Python</li>
  <li>to identify the nested key:value pairs we want to analyze</li>
  <li>to split a list </li>
  <li>to trouble shoot from an error report</li>
  <li>to handle exceptions</li>
  <li>to check type and use an "if/else" statement</li>
</ul>

<p><span class="left"><a href="module10.html">Previous Module</a></span>
<span class="right"><a href="module12.html">Next Module</a></span></p>



                </section>
              </article>
  			   </div>
  		</div>
  		
  		<footer>
  				<div class="wrap">
		<div id="rights">
		    <p>&copy; CC-BY 2014</p>
		    <p>The DH Bridge curriculum is supported by a microgrant from the <a href="http://ach.org/"><img src="http://dhbridge.org/images/ach-logo.png" width=50px ></a></p>
		</div>

	    <div id="contact">
	        <a href="mailto:bridgingdh@gmail.com"><i class="fa fa-paper-plane"></i></a>
	        <a href="https://twitter.com/dhbridge"><i class="fa fa-twitter"></i></a>
	        <a href="https://github.com/dhbridge/curriculum"><i class="fa fa-github"></i></a>
	    </div>
	</div>
  		</footer>

  </body>
</html>