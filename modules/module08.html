<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="" />
	  <meta name="viewport" content="width=device-width, user-scalable=no">
	
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic|Nova+Square' rel='stylesheet' type='text/css'>
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <title>Looping through the Pages</title>

    <link href="../stylesheets/codes.css" rel="stylesheet" type="text/css" />
    <link href="../stylesheets/style.css" rel="stylesheet" type="text/css" />
  </head>

  <body class="modules modules_module08">
    <!-- HEADER -->
        <header>
				<div class="wrap">
	    <h1 id="project_title">DH Bridge</h1>
	    <h2 class="tag">Encouraging Computational Thinking and Digital Skills in the Humanities</h2>

	    <nav id="pages">
	    	<a href="/">Computational Thinking</a>
	    	<a href="http://dhbridge.org">About DH Bridge</a>
	    </nav>
	</div>
        </header> 
        <!-- MAIN CONTENT -->
        <div class="wrap">
            <div id="main">
              <article>
                		<section id="sidebar">
			<h2>Modules</h2>
			<p><a href="/modules/installation.html">Installation Instructions</a></p>
			<p><a href="/modules/coaches-guide.html">Coaches Guide</a></p>

			<ol>
			<li><a href="/modules/module01.html">Working with your Computer</a></li>
			<li><a href="/modules/module02.html">Thinking about Data</a></li>
			<li><a href="/modules/module03.html">Getting Data</a></li>
			<li><a href="/modules/module04.html">Working with the API</a></li>
			<li><a href="/modules/module05.html">Writing Script Files</a></li>
			<li><a href="/modules/module06.html">Phase Two</a></li>
			<li><a href="/modules/module07.html">Using Functions and Loops</a></li>
			<li><a href="/modules/module08.html">Using While-Loops</a></li>
			<li><a href="/modules/module09.html">Writing Results to File</a></li>
			<li><a href="/modules/module10.html">Working with Local Data</a></li>
			<li><a href="/modules/module11.html">Analyzing the Data (Part 1)</a></li>
			<li><a href="/modules/module12.html">Analyzing the Data (Part 2)</a></li>
			<li><a href="/modules/module13.html">Saving Results to a File</a></li>
			<li><a href="/modules/module14.html">Next Steps</a></li>
			</ol>
		</section>

                <section id="content">
                        <h2>
          Looping through the Pages
      </h2>
       <p>In this module, we will learn to:</p>

<ol>
  <li>use a "while loop"</li>
  <li>create a "counter"</li>
</ol>

<p>We're getting there! We have a function to gather all of the search results on any given page. We now need a way to work systematically through all of the pages available.</p>

<p>To do that, we will add another loop to our "<code>pull_records</code>" function that allows us to move through more than one page of search results.</p>

<h3 id="introducing-the-while-loop">1. Introducing the <code>while</code> Loop</h3>

<p>The "for loop" allows us to do something to each item in a list. The "while loop" is a powerful tool that tells the computer to continue doing something as long as some criteria is true. We can use the "while loop" and a "counter" to work through all of the pages of search results.</p>

<p>To use a <code>while</code> loop, let's look again at our "<code>pull_records</code>" function.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>def pull_records(pages, end, size):
	paged_search = dpla.search('cooking',fields=['sourceResource'], page_size=size, page=pages)
	# print paged_search.items[2]
	save_each(paged_search)
</pre></td></tr></tbody></table>
</div>

<p>Remember, "<code>pages</code>" is a variable for the first page and "<code>end</code>" is a variable for the last page of search results we want. We want the <code>pull_records</code> function to retrieve every page of search results. In other words, if the page number is less than or equal to the total number of pages available, we want to get the search results from that page. Once we hit the end, we want to stop.</p>

<p>To write this logic into our existing function code, we will add:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>while(pages &lt;= end):
</pre></td></tr></tbody></table>
</div>

<p>so that our function now looks like this:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>def pull_records(pages, end, size):
	while(pages &lt;= end):
		paged_search = dpla.search('cooking',fields=['sourceResource'], page_size=size, page=pages)
		# print paged_search.items[2]
		save_each(paged_search)
</pre></td></tr></tbody></table>
</div>

<p>Can you see the problem with our current function? As it currently is written, "<code>pages</code>" is always less than "<code>end</code>" because it never increases. This means we would get stuck in an "<strong>infinite loop</strong>" if we tried to run the code right now â€” don't run the code at this point! If you did, that's OK, just stop the execution of the program with by hitting <code>ctrl + c</code> on the keyboard.</p>

<p>To avoid an "<strong>infinite loop</strong>", we need to increase the value of "<code>pages</code>" each time we work through the loop. We can do this by overwriting the value of "<code>pages</code>" to be "<code>pages + 1</code>".</p>

<p>Add "pages = pages +1" after <span class="command">save_each(paged_search)</span> like this:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre>def pull_records(pages, end, size):
		while(pages &lt;= end):
			paged_search = dpla.search('cooking',fields=['sourceResource'], page_size=size, page=pages)
			# print paged_search.items[2]					
			save_each(paged_search)
			pages = pages + 1
</pre></td></tr></tbody></table>
</div>

<p>Let's also add a print command to check that things are working as we expect. Above <span class="command">pages = pages + 1</span> add:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>print "finished page " + str(pages)
</pre></td></tr></tbody></table>
</div>

<p>Our file should now look like this:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></td><td class="code"><pre># Load Libraries
from dpla.api import DPLA

# Set Variables
dpla = DPLA('Your-Key-Here')
# result = dpla.search('cooking', fields=['sourceResource'], page_size = 50)
all_records = []

# Define Functions
def pull_records(pages, end, size):
	while(pages &lt;= end):
		paged_search = dpla.search('cooking',fields=['sourceResource'], page_size=size, page=pages)
		# print paged_search.items[2]
		save_each(paged_search)
		print "finished page " + str(pages)
		pages = pages + 1

def save_each(x):
	for each in x.items:
		all_records.append(each)

# Make Function Calls
# print result.items[1]
pull_records(2, 3, 50)
print all_records[30]
</pre></td></tr></tbody></table>
</div>

<p>Let's test our function on a subset of the pages. Change <span class="command">pull_records(2, 3, 50)</span> to <span class="command">pull_records(2, 5, 50)</span> and change <span class="command">print all_records[30]</span> to <span class="command">print all_records[150]</span></p>

<p>Save and run in Terminal.</p>

<h3 id="group-challenge">Group Challenge:</h3>

<p>Go back to your pen and paper and diagram a <code>while</code> loop. How does that diagram compare to the one you drew for the <code>for</code> loop?</p>

<p><span class="left"><a href="module07.html">Previous Module</a></span>
<span class="right"><a href="module09.html">Next Module</a></span></p>



                </section>
              </article>
  			   </div>
  		</div>
  		
  		<footer>
  				<div class="wrap">
		<div id="rights">
		    <p>&copy; CC-BY 2014</p>
		    <p>The DH Bridge curriculum is supported by a microgrant from the <a href="http://ach.org/"><img src="http://dhbridge.org/images/ach-logo.png" width=50px ></a></p>
		</div>

	    <div id="contact">
	        <a href="mailto:bridgingdh@gmail.com"><i class="fa fa-paper-plane"></i></a>
	        <a href="https://twitter.com/dhbridge"><i class="fa fa-twitter"></i></a>
	        <a href="https://github.com/dhbridge/curriculum"><i class="fa fa-github"></i></a>
	    </div>
	</div>
  		</footer>

  </body>
</html>