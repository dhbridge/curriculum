<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="" />
	  <meta name="viewport" content="width=device-width, user-scalable=no">
	
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic|Nova+Square' rel='stylesheet' type='text/css'>
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <title>Working with Local Data</title>

    <link href="../stylesheets/codes.css" rel="stylesheet" type="text/css" />
    <link href="../stylesheets/style.css" rel="stylesheet" type="text/css" />
  </head>

  <body class="modules modules_module10">
    <!-- HEADER -->
        <header>
				<div class="wrap">
	    <h1 id="project_title">DH Bridge</h1>
	    <h2 class="tag">Encouraging Computational Thinking and Digital Skills in the Humanities</h2>

	    <nav id="pages">
	    	<a href="/">Computational Thinking</a>
	    	<a href="http://dhbridge.org">About DH Bridge</a>
	    </nav>
	</div>
        </header> 
        <!-- MAIN CONTENT -->
        <div class="wrap">
            <div id="main">
              <article>
                		<section id="sidebar">
			<h2>Modules</h2>
			<p><a href="/modules/installation.html">Installation Instructions</a></p>
			<p><a href="/modules/coaches-guide.html">Coaches Guide</a></p>

			<ol>
			<li><a href="/modules/module01.html">Working with your Computer</a></li>
			<li><a href="/modules/module02.html">Thinking about Data</a></li>
			<li><a href="/modules/module03.html">Getting Data</a></li>
			<li><a href="/modules/module04.html">Working with the API</a></li>
			<li><a href="/modules/module05.html">Writing Script Files</a></li>
			<li><a href="/modules/module06.html">Phase Two</a></li>
			<li><a href="/modules/module07.html">Using Functions and Loops</a></li>
			<li><a href="/modules/module08.html">Using While-Loops</a></li>
			<li><a href="/modules/module09.html">Writing Results to File</a></li>
			<li><a href="/modules/module10.html">Working with Local Data</a></li>
			<li><a href="/modules/module11.html">Analyzing the Data (Part 1)</a></li>
			<li><a href="/modules/module12.html">Analyzing the Data (Part 2)</a></li>
			<li><a href="/modules/module13.html">Saving Results to a File</a></li>
			<li><a href="/modules/module14.html">Next Steps</a></li>
			</ol>
		</section>

                <section id="content">
                        <h2>
          Working with Local Data
      </h2>
       <p>In this module we will learn to:</p>

<ol>
  <li>create a new script file and load in our JSON data</li>
  <li>select data from particular fields and deal with missing data</li>
  <li>convert our JSON data to strings of text</li>
</ol>

<p>Now that we have a very large file of JSON data, we can work locally to find patterns that we could not find using the online interface for the DPLA's holdings. Since we are interested in the language being used in order to investigate how the descriptions of "cooking" items are gendered, our next step is to clean up that data and save it as text only so we can analyize it in later modules.</p>

<h3 id="create-a-new-script-and-load-in-our-data">1. Create a New Script and Load in Our Data</h3>

<p>It is time to create a new script file!</p>

<p>Go to Terminal and type:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>touch my_second_script.py
</pre></td></tr></tbody></table>
</div>

<p>or on Windows:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>New-Item -ItemType file my_second_script.py
</pre></td></tr></tbody></table>
</div>

<p>To open your new script file, type:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>open my_second_script.py
</pre></td></tr></tbody></table>
</div>

<p>or on Windows:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>Start notepad++ my_second_script.py
</pre></td></tr></tbody></table>
</div>

<p>First, we will need the JSON library again. To add this, add <span class="command">import json</span> to the very top of the file.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre># Load Libraries
import json
</pre></td></tr></tbody></table>
</div>

<p>Later in this module, we will need an additional library called "<code>kitchen</code>" so let's install and import that now.</p>

<p>In Terminal run:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>pip install kitchen
</pre></td></tr></tbody></table>
</div>

<p>"<code>kitchen</code>" is a bit of a "kitchen sink" of libraries - it holds a lot of different things. We will be using it to help with writing our strings, or more specifically, with the translating of the characters we read into the binary the computer reads. For that, we need only a very particular part of the library, the 'to_bytes' method. After "<code>import json</code>", add:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>#Load Libraries
import json
from kitchen.text.converters import to_bytes
</pre></td></tr></tbody></table>
</div>

<p>Now that we have our libraries in place, the next thing is to load up the data from our "<code>search_results.json</code>" file.</p>

<p>The structure for this is:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre># Set Variables
with open("search_results.json") as json_file:
    json_data = json.load(json_file)
</pre></td></tr></tbody></table>
</div>

<p>Here, we tell Python to open our "<code>search_results.json</code>" file and assign it to the variable "<code>json_file</code>". Then we use the "<code>load</code>" method from the JSON library to load up the data and save it as the variable "<code>json_data</code>".</p>

<p>Our second script file should now look like:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre># Load Libraries
import json
from kitchen.text.converters import to_bytes

# Set Variables
with open("search_results.json") as json_file:
    json_data = json.load(json_file)

# Define Functions

# Make Function Calls
</pre></td></tr></tbody></table>
</div>

<p>To make sure this worked, let's print out one item from the JSON data. Work with your table to add a "<code>print</code>" statement that prints the second item in the "<code>json_data</code>" list.</p>

<h3 id="select-the-relevant-text-data">2. Select the Relevant Text Data</h3>

<p>Our research question for this data is how, across the entire DPLA collection, the descriptions of items related to cooking are gendered. To pursue this question, we need to do some basic text analysis, so let's save our search results in a format that makes it easy to do that.</p>

<p>The next step is to select the fields that will be most helpful for analyzing how "cooking" items are described across the items in the DPLA.</p>

<p>Looking at our items, there are three main fields containing description-type information for our different "cooking" items: the title, the description, and the subject headings.</p>

<p>To start, let's make a new function called "<code>get_text</code>" that takes in our "<code>json_data</code>" list:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre># Define Functions
def get_text(json_data):
    # Do something to each item in json_data
</pre></td></tr></tbody></table>
</div>

<p>Next, for each item in that list, we want to look for the "title", the "description", and the "subject heading fields". This means using a "<code>for</code> loop".</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre># Define Functions
def get_text(json_data):
    for each in json_data:
        # Get the titles
        # Get the descriptions
        # Get the subject headings
</pre></td></tr></tbody></table>
</div>

<p>We can get the title, description, and subject headings by looking for those "keys" within each item in our "<code>json_data</code>" list.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre># Define Functions
def get_text(json_data):
    for each in json_data:
        # Get the title
        find_titles = each['sourceResource']['title']

        # Get the Description
        find_descriptions = each['sourceResource']['description']

        # Get the Subject Headings
        find_subjects = each['sourceResource']['subject']
</pre></td></tr></tbody></table>
</div>

<p>So far so good. But what if one of these fields is missing? Programming languages are very literal: if you tell it to do something that it cannot do, it just stops and gives you an error. To see this in action, let's add a line in "Make Function Calls" to call the function.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre># Load Libraries
import json
from kitchen.text.converters import to_bytes

# Set Variables
with open('search_results.json') as json_file:
    json_data = json.load(json_file)

# Define Functions
def get_text(json_data):
    for each in json_data:
        # Get the Titles
        find_titles = each['sourceResource']['title']

        # Get the Descriptions
        find_descriptions = each['sourceResource']['description']

        # Get the Subject Headings
        find_subjects = each['sourceResource']['subject']

# Make Function Calls
print json_data[1]
get_text(json_data)
</pre></td></tr></tbody></table>
</div>

<p>Towards the end of the error message, you should see a line that says "<code>KeyError: 'sourceResource.description'</code>". This is Python telling you that it cannot find a key "description" in one of the resources. Also, what do we do with when there are multiple values for each key, like with the Subject Headings?</p>

<p>Things are not as simple as they first appeared.</p>

<p>To fix this, let's create a second function that we can use to get the values associated with each key, and while we're at it, let's make sure those values are all in a consistent format. Since our final product will be a file of strings, let's save the values associated with our keys as a list of strings.</p>

<p>In your functions section, add a new function called "<code>get_fields</code>", which will do work on two variables, the "<code>item</code>" and the "<code>key</code>":</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre># Define Functions

def get_fields(item, key):
    # Return key from the sourceResource as a list of strings.

def get_texts(json_data):
</pre></td></tr></tbody></table>
</div>

<p>To start, we will assign the variable "<code>values</code>" to hold the values of whichever key we send to this function. To get those values, we will combine the same pattern as before, but add the "<code>get</code>" function. The "<code>get</code>" function will return a default value if the key we are looking for does not exist for an item (this is the second things being passed into the "<code>get</code>" function). We will set the default values to a string with just a space inside:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre># Define Functions

def get_fields(item, key):
    # Return key from the sourceResource as a list of strings.
    values = item[u'sourceResource'].get(key, [u' '])


def get_texts(json_data):
</pre></td></tr></tbody></table>
</div>

<p>We also want to make sure that what we get back is consistent. Because we know that some fields have multiple entries, we want everything to be a list. So, we will add a conditional statement to check if what we got back for the value is a string, and, if it is, convert it into a list. </p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre># Define Functions

def get_fields(item, key):
    # Return key from the sourceResource as a list of strings.
    values = item[u'sourceResource'].get(key, [u' '])
    if isinstance(values, basestring):
        values = [values]
    return values

def get_texts(json_data):
</pre></td></tr></tbody></table>
</div>

<p>We end with a "<code>return</code>" statement to send whatever the final product is back to whichever process used the "<code>get_fields</code>" function. </p>

<p>Now, let's use our "<code>get_fields()</code>" function inside the "<code>get_texts()</code>" function.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre># Define Functions

def get_fields(item, key):
    # Return key from the sourceResource as a list of strings.
    values = item[u'sourceResource'].get(key, [u' '])
    if isinstance(values, basestring):
        values = [values]
    return values

def get_texts(json_data):
    for each in json_data:
        # Get the title
        title = get_fields(each, u'title')

        # Get the Description
        description = get_fields(each, u'description')

        # Get the Subject Headings
        subject_info = get_fields(each, u'subject')
</pre></td></tr></tbody></table>
</div>

<p>With your group, talk through what is going on in these functions. Work together to trace how the information is traveling between the functions. Add <code>print</code> statements to inspect the data at different points.</p>

<p>We are almost there! However, we have to do a little extra work on each of the values. Remember how we saved all of the values as lists, because sometimes there are multiple of values for every key? Now that we have all of the values, we need to combine them into a single string for each key (title, description, and subject headings). </p>

<p>For "<code>title</code>" and "<code>description</code>", this means using the "<code>join</code>" function to merge all of the list items into a string. </p>

<p>For the subject headings, however, it is a bit more complicated. We will create a second loop for the subject headings to isolate the values held by the "<code>name</code>" key, and then save each of the subject headings to a new list before joining the list together into a string.</p>

<p>Let's go for it!</p>

<p>First, add a join statement to the title and description sections. We will separate multiple entries with a comma and a space. Work with your table to understand the join statement. Use print statements to see what is happening</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre>def get_texts(json_data):
    for each in json_data:
        # Get the title
        title = get_fields(each, u'title')
        title = (u', '.join(titles))

        # Get the Description
        description = get_fields(each, u'description')
        description = (u', '.join(descriptions))

        # Get the Subject Headings
        subject_info = get_fields(each, u'subject')
</pre></td></tr></tbody></table>
</div>

<p>Then create an empty list named "<code>subjects</code>" to save the subject headings to:           </p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre>def get_texts(json_data):
    for each in json_data:
        # Get the title
        title = get_fields(each, u'title')
        title = (u', '.join(titles))

        # Get the Description
        description = get_fields(each, u'description')
        description = (u', '.join(descriptions))

        # Get the Subject Headings
        subjects = []
        subject_info = get_fields(each, u'subject')
</pre></td></tr></tbody></table>
</div>

<p>Now, create a loop to get the subject headings, which are the values associated with the key "<code>name</code>", and add those values to the new "<code>subjects</code>" list. </p>

<p>Because there are a few items with only one subject heading and no key "<code>name</code>", we will use "<code>try</code>" and "<code>except</code>". This way we can tell the computer to try first to get the values associated with the key "<code>name</code>", but if it can't find that key, to take the first item in the list. </p>

<p>Then, we will use "<code>append</code>" to add each value to our list of subjects. And finally, we can join that list of subjects into its own string, just like we did with "<code>title</code>" and "<code>description</code>".</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></td><td class="code"><pre>def get_texts(json_data):
    for each in json_data:
        
        # Get the title
        titles = get_fields(each, u'title')
        title = (u', '.join(titles))
  
        # Get the Description
        descriptions = get_fields(each, u'description')
        description = (u', '.join(descriptions))


        # Get the Subject Headings
        subjects = []
        subject_info = get_fields(each, u'subject')

        for info in subject_info:
            try:
                subj = info[u'name']
            except:
                subj = info[0]
            subjects.append(subj)

        subject = (u', '.join(subjects))
</pre></td></tr></tbody></table>
</div>

<p>Now, let's pull all our pieces - the title, the description, and the subject headings - together into a new variable. We will make each result into a sentence, which will allow us to apply interesting text-mining processes to our text in a later module.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></td><td class="code"><pre># Define Functions

def get_fields(item, key):
    # Return key from the sourceResource as a list of strings.
    values = item[u'sourceResource'].get(key, [u' '])
    if isinstance(values, basestring):
        values = [values]
    return values

def get_texts(json_data):
    for each in json_data:
        
        # Get the title
        titles = get_fields(each, u'title')
        title = (u', '.join(titles))
  
        # Get the Description
        descriptions = get_fields(each, u'description')
        description = (u', '.join(descriptions))


        # Get the Subject Headings
        subjects = []
        subject_info = get_fields(each, u'subject')

        for info in subject_info:
            try:
                subj = info[u'name']
            except:
                subj = info[0]
            subjects.append(subj)

        subject = (u', '.join(subjects))

        # Combine the data into a single variable in the form of a sentence
        data = u'{}; {}; {}.\n'.format(title, description, subject)
</pre></td></tr></tbody></table>
</div>

<p>The brackets indicate that some information will be inserted into that location. In this case, order really does matter. The first bracket takes the value held in <code>title</code> because it is the first thing passed into the "<code>format</code>" function. The second bracket takes the value of <code>description</code> because it was passed in next, and so on.  Finally, the "<code>\n</code>" adds a "Return" to the end of the line, so that the information for each item appears on a new line.</p>

<p>The last step is to save this data into a text file. Similar to last time, we need to set up the file that will receive that data. At the top of the file, add a variable "<code>f</code>" that holds a new "text_results.txt" file.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre># Load Libraries
import json
from kitchen.text.converters import to_bytes

# Set Variables
with open("search_results.json") as json_file:
    json_data = json.load(json_file)

f = open('text_results.txt', 'w')
</pre></td></tr></tbody></table>
</div>

<p>Now back in our "<code>get_texts()</code>" function, the last step is to write all the information within "data" to our file.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></td><td class="code"><pre>def get_texts(json_data):
    for each in json_data:
        
        # Get the title
        titles = get_fields(each, u'title')
        title = (u', '.join(titles))
  
        # Get the Description
        descriptions = get_fields(each, u'description')
        description = (u', '.join(descriptions))


        # Get the Subject Headings
        subjects = []
        subject_info = get_fields(each, u'subject')

        for info in subject_info:
            try:
                subj = info[u'name']
            except:
                subj = info[0]
            subjects.append(subj)

        subject = (u', '.join(subjects))

        # Combine the data into a single variable in the form of a sentence
        data = u'{}; {}; {}.\n'.format(title, description, subject)

        # Write the sentence to the 'text_results' file
        f.write(to_bytes(data))
</pre></td></tr></tbody></table>
</div>

<p>Finally, let's add a call to the function:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></td><td class="code"><pre># Load Libraries
import json
from kitchen.text.converters import to_bytes

# Set Variables
with open("search_results.json") as json_file:
    json_data = json.load(json_file)

f = open('text_results.txt', 'w')

# Define Functions
def get_fields(item, key):
    # Return key from the sourceResource as a list of strings.
    values = item[u'sourceResource'].get(key, [u' '])
    if isinstance(values, basestring):
        values = [values]
    return values

def get_texts(json_data):
    for each in json_data:
        
        # Get the title
        titles = get_fields(each, u'title')
        title = (u', '.join(titles))
  
        # Get the Description
        descriptions = get_fields(each, u'description')
        description = (u', '.join(descriptions))


        # Get the Subject Headings
        subjects = []
        subject_info = get_fields(each, u'subject')

        for info in subject_info:
            try:
                subj = info[u'name']
            except:
                subj = info[0]
            subjects.append(subj)

        subject = (u', '.join(subjects))

        # Combine the data into a single variable in the form of a sentence
        data = u'{}; {}; {}.\n'.format(title, description, subject)

        # Write the sentence to the 'text_results' file
        f.write(to_bytes(data))

# Make Function Calls
get_texts(json_data)
</pre></td></tr></tbody></table>
</div>

<p>Save and run your second Python script. You should now have a file named "<code>text_results.txt</code>" in your "<code>dhb_awesome</code>" directory. If you open that file, you should see lines of beautiful text ready for analysis.</p>

<p>In the next module, we will use the Natural Language ToolKit, a powerful Python library for working with text, to find patterns in the text data.</p>

<h3 id="bonus-challenge">Bonus Challenge:</h3>
<p>Research Python data types with your table. Which data types have we already worked with? Why do data types matter?</p>

<h3 id="credits">Credits</h3>

<p>Many thanks to Eric Rochester for his help <a href="https://gist.github.com/erochest/4debe339ec9d2bf5ea5a">(https://gist.github.com/erochest/4debe339ec9d2bf5ea5a)</a> with refactoring this module.</p>

<p><span class="left"><a href="module09.html">Previous Module</a></span>
<span class="right"><a href="module11.html">Next Module</a></span></p>



                </section>
              </article>
  			   </div>
  		</div>
  		
  		<footer>
  				<div class="wrap">
		<div id="rights">
		    <p>&copy; CC-BY 2014</p>
		    <p>The DH Bridge curriculum is supported by a microgrant from the <a href="http://ach.org/"><img src="http://dhbridge.org/images/ach-logo.png" width=50px ></a></p>
		</div>

	    <div id="contact">
	        <a href="mailto:bridgingdh@gmail.com"><i class="fa fa-paper-plane"></i></a>
	        <a href="https://twitter.com/dhbridge"><i class="fa fa-twitter"></i></a>
	        <a href="https://github.com/dhbridge/curriculum"><i class="fa fa-github"></i></a>
	    </div>
	</div>
  		</footer>

  </body>
</html>