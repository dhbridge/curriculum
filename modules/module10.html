<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="" />
	  <meta name="viewport" content="width=device-width, user-scalable=no">
	
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic|Nova+Square' rel='stylesheet' type='text/css'>
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <title>Working with Local Data</title>

    <link href="../stylesheets/codes.css" rel="stylesheet" type="text/css" />
    <link href="../stylesheets/style.css" rel="stylesheet" type="text/css" />
  </head>

  <body class="modules modules_module10">
    <!-- HEADER -->
        <header>
				<div class="wrap">
	    <h1 id="project_title">DH Bridge</h1>
	    <h2 class="tag">Encouraging Computational Thinking and Digital Skills in the Humanities</h2>

	    <nav id="pages">
	    	<a href="/">Computational Thinking</a>
	    	<a href="http://dhbridge.org">About DH Bridge</a>
	    </nav>
	</div>
        </header> 
        <!-- MAIN CONTENT -->
        <div class="wrap">
            <div id="main">
              <article>
                		<section id="sidebar">
			<h2>Modules</h2>
			<a href="/modules/installation.html">Installation Instructions</a>

			<ol>
			<li><a href="/modules/module01.html">Working with your Computer</a></li>
			<li><a href="/modules/module02.html">Thinking about Data</a></li>
			<li><a href="/modules/module03.html">Getting Data</a></li>
			<li><a href="/modules/module04.html">Working with the API</a></li>
			<li><a href="/modules/module05.html">Writing Script Files</a></li>
			<li><a href="/modules/module06.html">Phase Two</a></li>
			<li><a href="/modules/module07.html">Using Functions and Loops</a></li>
			<li><a href="/modules/module08.html">Using While-Loops</a></li>
			<li><a href="/modules/module09.html">Writing Results to File</a></li>
			<li><a href="/modules/module10.html">Working with Local Data</a></li>
			<li><a href="/modules/module11.html">Analyzing the Data (Part 1)</a></li>
			<li><a href="/modules/module12.html">Analyzing the Data (Part 2)</a></li>
			<li><a href="/modules/module13.html">Saving Results to a File</a></li>
			</ol>
		</section>

                <section id="content">
                        <h2>
          Working with Local Data
      </h2>
       <p>In this module we will learn:</p>

<ol>
  <li>to create a new script file and load in our JSON data</li>
  <li>to select data from particular fields and deal with missing data</li>
  <li>to convert our JSON data to strings of text</li>
</ol>

<p>Now that we have a very large file of JSON data, we can work locally to find  patterns that we could not find using the online interface for the DPLA's holdings. Because we are interested in the language being used in order to investigate how the descriptions of 'cooking' items are gendered, our task for this module is to filter down that data and save it as text. </p>

<h3 id="create-a-new-script-and-load-in-our-data">1. Create a new script and load in our data</h3>

<p>It is time to create a new script file!</p>

<p>Go to terminal and type:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>touch my_second_script.py 
</pre></td></tr></tbody></table>
</div>

<p>or on Windows: </p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>New-Item -ItemType file my_second_script.py
</pre></td></tr></tbody></table>
</div>

<p>To open your new script file, type:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>open my_second_script.py
</pre></td></tr></tbody></table>
</div>

<p>or on Windows:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>Start notepad++ my_second_script.py
</pre></td></tr></tbody></table>
</div>

<p>First, we will need the json library again. To add this, add <span class="command">import json</span> to the very top of the file.</p>

<p>The next thing is to load up the data from our "search_results.json" file.</p>

<p>The structure for this is:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>with open("search_results.json") as json_file:
    json_data = json.load(json_file)
</pre></td></tr></tbody></table>
</div>

<p>Here, we tell Python to "open" our "search_results.json" file and assign it to the variable "json_file". The we use the "load" method in the "json.library" to load up the data and save it as the variable "json_data". </p>

<p>Our second script file should now look like:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>import json

with open("search_results.json") as json_file:
    json_data = json.load(json_file)    
</pre></td></tr></tbody></table>
</div>

<p>To make sure this worked, let's print out one item from the json data. Work with your table to add a print statement to print the second item in the json_data list.</p>

<h3 id="select-the-relevant-text-data">2. Select the relevant text data</h3>

<p>The next step is to select the fields that will be most helpful for analyzing how 'cooking' items are described across the items in the DPLA.</p>

<p>Looking at our items, there are three main fields containing description type information for our different 'cooking' items: the title, the description, and the subject headings. </p>

<p>Our question for these items is how, across the entire DPLA collection, the descriptions of items related to cooking are gendered. To do this, we need to do some basic text analysis, so let's save our search results in a format that makes it easy to do that: as text.</p>

<p>To start, let's make a new function called 'get_text' that takes in our 'json_data' list:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>def get_text(json_data):
    # Do something to each item in json_data
</pre></td></tr></tbody></table>
</div>

<p>Next, for each item in that array, we want to look for the 'title', the 'description', and the 'subject heading fields'. This means using another 'for loop'. </p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre>def get_text(json_data):
    for each in json_data:
        # Get the title

        # Get the description

        # Get the subject headings
</pre></td></tr></tbody></table>
</div>

<p>We can get the title, description, and subject headings by looking for those 'keys' within each item in our 'json_data' list. </p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre>def get_text(json_data):
    for each in json_data:
        # Get the title
        title = each['sourceResource.title']

        # Get the Description
        description = each['sourceResource.description']

        # Get the Subject Headings
        subject = each['sourceResource.subject']
</pre></td></tr></tbody></table>
</div>

<p>So far so good. But what if one of these fields is missing? Programming languages are very literal - if you tell it to do something that it cannot do, it just stops and gives you an error. To see this in action, let's add a line to call the function.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre>import json

with open("search_results.json") as json_file:
    json_data = json.load(json_file) 

def get_text(json_data):
    for each in json_data:
        # Get the Titles
        title = each['sourceResource.title']

        # Get the Descriptions
        description = each['sourceResource.description']

        # Get the Subject Headings
        subject = each['sourceResource.subject']

get_text(json_data)
</pre></td></tr></tbody></table>
</div>

<p>Towards the end of the error message, you should see a line that says "KeyError: 'sourceResource.description'". This is Python telling you that it cannot find a key 'title' in one of the resources.</p>

<p>To deal with this, we use 'try' and 'except' - we will tell the computer to try to find the keys, but if it doesn't, to assign the value to blank and move on.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre>def get_text(json_data):
    for each in json_data:
        try:
            title = each['sourceResource.title']
        except:
            title = ' '
        
        try:
            description = each['sourceResource.description']
        except:
            description = ' '

        try:
            subject = each['sourceResource.subject']
        except:
            subject = ' '
</pre></td></tr></tbody></table>
</div>

<p>There are two more steps we need to get the text ready to save. The first step is to get all of the data out of lists and make sure that it is in the form of a string.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></td><td class="code"><pre>def get_text(json_data):
    for each in json_data:
        try:
            title = each['sourceResource.title']
            if isinstance(title, basestring):
                title = str(titles)
            else:
                for each in title:
                    title = str(each)
        except:
            title = ' '
        
        try:
            description = each['sourceResource.description']

            if isinstance(description, basestring):
                description = str(description)
            else:
                for line in description:
                    description = str(line)
        except:
            description = ' '

        try:
            subject = each['sourceResource.subject']

            if isinstance(subject, basestring):
                subject = str(subject)
            else:
                for each in subject:
                    subject = []
                    subject.append(each['name'])  
        except:
            subject = ' '
</pre></td></tr></tbody></table>
</div>

<p>You might notice two odd things with this function. First, we are reusing variable names. Variables hold the last thing passed to them, so we can overwrite the value of a variable to update it as we go along. </p>

<p>Second, we are handling the subject field differently than title and description. This is because the subject key holds an additional list, rather than just values. Work in your groups to map out what is going on in the subject section of the funciton.</p>

<p>The last is to save this data into a text file. Similar to last time, we need to set up the file that will receive that data:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre>import json

with open("search_results.json") as json_file:
    json_data = json.load(json_file) 

f = open('text_results.txt', 'a')
</pre></td></tr></tbody></table>
</div>

<p>The major difference here is that we are opening the file as append so that we can save each line of data as we loop, rather than storing it all and writing it all at once.</p>

<p>Our whole file should now look like this:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></td><td class="code"><pre>import json

with open("search_results.json") as json_file:
    json_data = json.load(json_file) 

f = open('text_results.txt', 'a')

def get_text(json_data):
    for each in json_data:
        try:
            title = each['sourceResource.title']
            if isinstance(title, basestring):
                title = str(titles)
            else:
                for each in title:
                    title = str(each)
        except:
            title = ' '
        
        try:
            description = each['sourceResource.description']

            if isinstance(description, basestring):
                description = str(description)
            else:
                for line in description:
                    description = str(line)
        except:
            description = ' '

        try:
            subject = each['sourceResource.subject']

            if isinstance(subject, basestring):
                subject = str(subject)
            else:
                for each in subject:
                    subject = []
                    subject.append(each['name'])  
        except:
            subject = ' '
</pre></td></tr></tbody></table>
</div>

<p>Now, let's go back to the function and put all our pieces together into a new variable.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></td><td class="code"><pre>def get_text(json_data):
    for each in json_data:
        try:
            title = each['sourceResource.title']
            if isinstance(title, basestring):
                title = str(titles)
            else:
                for each in title:
                    title = str(each)
        except:
            title = ' '
        
        try:
            description = each['sourceResource.description']

            if isinstance(description, basestring):
                description = str(description)
            else:
                for line in description:
                    description = str(line)
        except:
            description = ' '

        try:
            subject = each['sourceResource.subject']

            if isinstance(subject, basestring):
                subject = str(subject)
            else:
                for each in subject:
                    subject = []
                    subject.append(each['name'])  
        except:
            subject = ' '

    data = title + '; ' + description + '; ' + ', '.join(subject) + '. \n'
</pre></td></tr></tbody></table>
</div>

<p>This line takes the information held in title, adds a ';' and a space, takes the information in description, add '; and a space, and finally, takes the list held in subject and smashes it together into a string, separated by a comman and a space. Finally, the '\n' adds an 'enter' the end of the line, so that the information for each item appears on a new line.</p>

<p>The last step is to write all the information within 'data' to our file.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></td><td class="code"><pre>def get_text(json_data):
    for each in json_data:
        try:
            title = each['sourceResource.title']
            if isinstance(title, basestring):
                title = str(titles)
            else:
                for each in title:
                    title = str(each)
        except:
            title = ' '
        
        try:
            description = each['sourceResource.description']

            if isinstance(description, basestring):
                description = str(description)
            else:
                for line in description:
                    description = str(line)
        except:
            description = ' '

        try:
            subject = each['sourceResource.subject']

            if isinstance(subject, basestring):
                subject = str(subject)
            else:
                for each in subject:
                    subject = []
                    subject.append(each['name'])  
        except:
            subject = ' '

    data = title + '; ' + description + '; ' + ', '.join(subject) + '. \n'

    f.write(data.encode('utf-8'))
</pre></td></tr></tbody></table>
</div>

<p>Don't worry too much about the 'encode('utf-8')' bit - it forces all of the data into a consistent format and fixes a small problem of unusual characters.</p>

<p>Now let's add a call to the function and run our code:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></td><td class="code"><pre>import json

with open("search_results.json") as json_file:
    json_data = json.load(json_file) 

f = open('text_results.txt', 'a')

def get_text(json_data):
    for each in json_data:
        try:
            title = each['sourceResource.title']
            if isinstance(title, basestring):
                title = str(titles)
            else:
                for each in title:
                    title = str(each)
        except:
            title = ' '
        
        try:
            description = each['sourceResource.description']

            if isinstance(description, basestring):
                description = str(description)
            else:
                for line in description:
                    description = str(line)
        except:
            description = ' '

        try:
            subject = each['sourceResource.subject']

            if isinstance(subject, basestring):
                subject = str(subject)
            else:
                for each in subject:
                    subject = []
                    subject.append(each['name'])  
        except:
            subject = ' '

    data = title + '; ' + description + '; ' + ', '.join(subject) + '. \n'

    f.write(data.encode('utf-8'))

get_text(json_data)
</pre></td></tr></tbody></table>
</div>

<p>Save and run your second python script. You should now have a text file named 'text_results.txt' in your directory. If you open that file, you should see lines of beautiful text ready for analysis.</p>

<p>In the next module, we will use the Natural Language ToolKit, a powerful Python library for working with text, to find patterns in the text data.</p>

<p><span class="left"><a href="module09.html">Previous Module</a></span>
<span class="right"><a href="module11.html">Next Module</a></span></p>



                </section>
              </article>
  			   </div>
  		</div>
  		
  		<footer>
  				<div class="wrap">
		<div id="rights">
		    <p>&copy; CC-BY 2014</p>
		    <p>The DH Bridge curriculum is supported by a microgrant from the <a href="http://ach.org/"><img src="http://dhbridge.org/images/ach-logo.png" width=50px ></a></p>
		</div>

	    <div id="contact">
	        <a href="mailto:bridgingdh@gmail.com"><i class="fa fa-paper-plane"></i></a>
	        <a href="https://twitter.com/dhbridge"><i class="fa fa-twitter"></i></a>
	        <a href="https://github.com/dhbridge/curriculum"><i class="fa fa-github"></i></a>
	    </div>
	</div>
  		</footer>

  </body>
</html>